<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Swipe Actions Demo</title>
  <style>
    :root {
      --black: #000000;
      --layer: #111111;
      --border: rgba(255, 255, 255, 0.18);
      --text: rgba(255, 255, 255, 0.9);
      --feint-text: rgba(255, 255, 255, 0.6);
      --hue-1: #9df3ff;
      --hue-2: #ffd590;
      --hue-3: #ff9ba4;
      --hue-4: #b2ffb9;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f5f5f7;
      display: grid;
      place-items: center;
      min-height: 100vh;
    }

    #root {
      width: 100%;
      display: flex;
      justify-content: center;
    }

    button {
      background: transparent;
      border: none;
      padding: 0;
      color: inherit;
      font: inherit;
      cursor: default;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  <script>
    (function () {
      const React = window.React;
      const ReactDOM = window.ReactDOM;

      const resolveFramer = () => {
        const candidates = [
          window.framerMotion,
          window.FramerMotion,
          window["framer-motion"],
          window.Motion,
          window.motion
        ];
        for (const candidate of candidates) {
          if (!candidate) continue;
          if (candidate.motion || candidate.AnimatePresence) return candidate;
          if (candidate.default && (candidate.default.motion || candidate.default.AnimatePresence)) {
            return candidate.default;
          }
        }
        return null;
      };

      const framer = resolveFramer();
      if (!React || !ReactDOM || !framer) {
        const root = document.getElementById("root");
        if (root) {
          root.innerHTML = "Missing React or Framer Motion globals.";
        }
        return;
      }

      const {
        motion,
        animate,
        useMotionValue,
        useSpring,
        useTransform
      } = framer;

      const { useCallback, useEffect, useMemo, useRef, useState } = React;
      const SPRING = { stiffness: 900, damping: 80 };

      const MailOpenIcon = (props) =>
        React.createElement(
          "svg",
          {
            width: props.size || 24,
            height: props.size || 24,
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: props.strokeWidth || 1.5,
            strokeLinecap: "round",
            strokeLinejoin: "round"
          },
          React.createElement("path", {
            d: "M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z"
          }),
          React.createElement("path", {
            d: "m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10"
          })
        );

      const Clock9Icon = (props) =>
        React.createElement(
          "svg",
          {
            width: props.size || 24,
            height: props.size || 24,
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: props.strokeWidth || 1.5,
            strokeLinecap: "round",
            strokeLinejoin: "round"
          },
          React.createElement("circle", { cx: "12", cy: "12", r: "10" }),
          React.createElement("polyline", { points: "12 6 12 12 7.5 12" })
        );

      const ArchiveIcon = (props) =>
        React.createElement(
          "svg",
          {
            width: props.size || 24,
            height: props.size || 24,
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: props.strokeWidth || 1.5,
            strokeLinecap: "round",
            strokeLinejoin: "round"
          },
          React.createElement("rect", { width: "20", height: "5", x: "2", y: "3", rx: "1" }),
          React.createElement("path", { d: "M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8" }),
          React.createElement("path", { d: "M10 12h4" })
        );

      const FlagIcon = (props) =>
        React.createElement(
          "svg",
          {
            width: props.size || 24,
            height: props.size || 24,
            viewBox: "0 0 24 24",
            fill: "none",
            stroke: "currentColor",
            strokeWidth: props.strokeWidth || 1.5,
            strokeLinecap: "round",
            strokeLinejoin: "round"
          },
          React.createElement("path", {
            d: "M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"
          }),
          React.createElement("line", { x1: "4", x2: "4", y1: "22", y2: "15" })
        );

      const styles = {
        outerContainer: { padding: 16, cursor: "default" },
        swipeContainer: {
          position: "relative",
          height: 80,
          width: "80dvw",
          maxWidth: 384,
          overflow: "hidden",
          backgroundColor: "black",
          borderRadius: 12,
          border: "1px solid var(--border)",
          zIndex: 0,
          touchAction: "none"
        },
        swipeItem: {
          position: "absolute",
          inset: 0,
          backgroundColor: "var(--layer)",
          zIndex: 10,
          display: "flex",
          alignItems: "center",
          justifyContent: "center"
        },
        actionsGroup: {
          position: "absolute",
          height: "100%",
          width: "100%",
          userSelect: "none",
          WebkitUserSelect: "none",
          display: "flex"
        },
        action: {
          fullWidthContainer: { position: "absolute", inset: 0, display: "flex" },
          centerer: {
            height: "100%",
            width: "25%",
            display: "flex",
            alignItems: "center",
            justifyContent: "center"
          },
          animatedWrapper: { fontSize: 12 }
        },
        actionContent: {
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          gap: 4,
          flexDirection: "column",
          color: "var(--text)"
        },
        swipeItemContent: {
          backgroundColor: "transparent",
          userSelect: "none",
          WebkitUserSelect: "none",
          fontSize: 14,
          color: "var(--feint-text)",
          textAlign: "center",
          lineHeight: 1.5
        }
      };

      function SwipeItemContent({ swipeProgress }) {
        const opacity = useTransform(swipeProgress, [-0.5, 0, 0.5], [0, 1, 0]);
        const opacitySmooth = useSpring(opacity, SPRING);
        const x = useTransform(swipeProgress, [-0.5, 0, 0.5], [40, 0, -40]);
        const xSmooth = useSpring(x, SPRING);

        return React.createElement(
          motion.div,
          {
            style: Object.assign({}, styles.swipeItemContent, {
              opacity: opacitySmooth,
              x: xSmooth
            })
          },
          "Swipe left or right to reveal actions"
        );
      }

      function ActionContent({ icon: Icon, label }) {
        return React.createElement(
          motion.button,
          {
            style: styles.actionContent,
            whileTap: { scale: 0.92 }
          },
          React.createElement(Icon, { size: 24, strokeWidth: 1.5 }),
          label
        );
      }

      function Action({
        children,
        primary = false,
        swipeProgress,
        side,
        bgColor = "var(--black)"
      }) {
        const actionRef = useRef(null);
        const widthRef = useRef(0);

        const offset = useMemo(() => useMotionValue(0), []);
        const offsetSmooth = useSpring(offset, SPRING);

        const computeOffset = useCallback(
          (progress) => {
            const width = widthRef.current;
            if (!primary) return 0;
            if (Math.abs(progress) >= 0.8) return 0;
            return -(progress * width * 0.5);
          },
          [primary]
        );

        useEffect(() => {
          const update = () => {
            const width = actionRef.current?.getBoundingClientRect().width;
            if (!width) return;
            widthRef.current = width;
            offset.set(computeOffset(swipeProgress.get()));
          };
          update();
          window.addEventListener("resize", update);
          return () => window.removeEventListener("resize", update);
        }, [computeOffset, offset, swipeProgress]);

        useEffect(() => {
          const unsubscribe = swipeProgress.on("change", (value) => {
            offset.set(computeOffset(value));
          });
          return () => unsubscribe();
        }, [computeOffset, offset, swipeProgress]);

        const baseOpacity = primary ? 1 : 0;
        const opacity = useTransform(
          swipeProgress,
          [-1, -0.8, -0.5, -0.25, 0.25, 0.5, 0.8, 1],
          [baseOpacity, 1, 1, 0, 0, 1, 1, baseOpacity]
        );
        const opacitySmooth = useSpring(opacity, SPRING);

        const x = useTransform(
          swipeProgress,
          [-1, -0.8, -0.5, 0.5, 0.8, 1],
          [0, 16, 0, 0, -16, 0]
        );
        const xSmooth = useSpring(x, SPRING);

        const scale = useTransform(
          swipeProgress,
          [-1, -0.8, 0, 0.8, 1],
          [1, 0.8, 1, 0.8, 1]
        );
        const scaleSmooth = useSpring(scale, SPRING);

        return React.createElement(
          motion.div,
          {
            ref: actionRef,
            style: Object.assign({}, styles.action.fullWidthContainer, {
              justifyContent: side === "right" ? "flex-start" : "flex-end",
              x: offsetSmooth,
              backgroundColor: bgColor
            })
          },
          React.createElement(
            motion.div,
            { style: styles.action.centerer },
            React.createElement(
              motion.span,
              {
                style: Object.assign({}, styles.action.animatedWrapper, {
                  x: xSmooth,
                  opacity: opacitySmooth,
                  scale: scaleSmooth,
                  transformOrigin: side === "right" ? "right" : "left"
                })
              },
              children
            )
          )
        );
      }

      function ActionsGroup({ swipeAmount, side, primaryAction, secondaryAction }) {
        return React.createElement(
          motion.div,
          {
            style: Object.assign({}, styles.actionsGroup, {
              left: side === "right" ? "100%" : undefined,
              right: side === "left" ? "100%" : undefined,
              x: swipeAmount
            })
          },
          secondaryAction,
          primaryAction
        );
      }

      function SwipeDemo() {
        const dragging = useRef(false);
        const swipeItemRef = useRef(null);
        const containerRef = useRef(null);
        const widthRef = useRef(0);
        const startX = useRef(0);
        const startOffset = useRef(0);
        const lockedSide = useRef(null);

        const x = useMotionValue(0);
        const smoothX = useSpring(x, SPRING);
        const progress = useTransform(x, (value) =>
          widthRef.current ? value / widthRef.current : 0
        );

        useEffect(() => {
          const onMove = (event) => {
            if (!dragging.current) return;
            const width = widthRef.current;
            if (!width) return;

            const raw = event.clientX - startX.current + startOffset.current;
            const threshold = 0.8 * width;
            const abs = Math.abs(raw);
            const isLeft = raw < 0;

            if (lockedSide.current) {
              if (abs < threshold) {
                lockedSide.current = null;
                x.set(raw);
              } else {
                x.set(lockedSide.current === "left" ? -width : width);
              }
              return;
            }

            if (abs > threshold) {
              lockedSide.current = isLeft ? "left" : "right";
              x.set(isLeft ? -width : width);
              return;
            }

            const clamped = Math.max(-width, Math.min(width, raw));
            x.set(clamped);
          };

          const onUp = () => {
            if (!dragging.current) return;
            dragging.current = false;

            const width = widthRef.current;
            if (!width) {
              lockedSide.current = null;
              x.set(0);
              return;
            }

            const value = x.get();
            let target = 0;

            if (Math.abs(value) > width * 0.25) {
              target = value > 0 ? width * 0.5 : -width * 0.5;
            }

            if (lockedSide.current) {
              if (containerRef.current) {
                animate(
                  containerRef.current,
                  { scaleY: 1.05, scaleX: 0.95, y: -24, pointerEvents: "none" },
                  { duration: 0.1, ease: "easeOut" }
                );
                animate(
                  containerRef.current,
                  { scaleY: 1, scaleX: 1, y: 0, pointerEvents: "auto" },
                  { duration: 0.6, type: "spring" }
                );
              }
              target = 0;
              animate(x, target, { duration: 0.5, delay: 0.3 });
            } else {
              x.set(target);
            }

            lockedSide.current = null;
          };

          document.addEventListener("pointermove", onMove);
          document.addEventListener("pointerup", onUp);
          document.addEventListener("pointercancel", onUp);
          return () => {
            document.removeEventListener("pointermove", onMove);
            document.removeEventListener("pointerup", onUp);
            document.removeEventListener("pointercancel", onUp);
          };
        }, [x]);

        useEffect(() => {
          const update = () => {
            const width = swipeItemRef.current?.getBoundingClientRect().width;
            if (!width) return;
            widthRef.current = width;
            const value = progress.get() * width;
            x.set(value);
          };
          update();
          window.addEventListener("resize", update);
          return () => window.removeEventListener("resize", update);
        }, [progress, x]);

        return React.createElement(
          "div",
          { style: styles.outerContainer },
          React.createElement(
            motion.div,
            {
              ref: containerRef,
              style: styles.swipeContainer,
              onPointerDown: (event) => {
                event.preventDefault();
                dragging.current = true;
                startX.current = event.clientX;
                startOffset.current = x.get();
                if (event.currentTarget?.setPointerCapture) {
                  event.currentTarget.setPointerCapture(event.pointerId);
                }
              },
              onPointerUp: (event) => {
                if (event.currentTarget?.releasePointerCapture) {
                  event.currentTarget.releasePointerCapture(event.pointerId);
                }
              }
            },
            React.createElement(
              motion.div,
              {
                ref: swipeItemRef,
                style: Object.assign({}, styles.swipeItem, { x: smoothX })
              },
              React.createElement(SwipeItemContent, { swipeProgress: progress })
            ),
            React.createElement(ActionsGroup, {
              side: "left",
              swipeAmount: smoothX,
              primaryAction: React.createElement(
                Action,
                {
                  primary: true,
                  swipeProgress: progress,
                  side: "left",
                  bgColor: "var(--hue-1)"
                },
                React.createElement(ActionContent, { icon: MailOpenIcon, label: "Action 1" })
              ),
              secondaryAction: React.createElement(
                Action,
                {
                  swipeProgress: progress,
                  side: "left",
                  bgColor: "var(--hue-2)"
                },
                React.createElement(ActionContent, { icon: Clock9Icon, label: "Action 2" })
              )
            }),
            React.createElement(ActionsGroup, {
              side: "right",
              swipeAmount: smoothX,
              primaryAction: React.createElement(
                Action,
                {
                  primary: true,
                  swipeProgress: progress,
                  side: "right",
                  bgColor: "var(--hue-3)"
                },
                React.createElement(ActionContent, { icon: ArchiveIcon, label: "Action 3" })
              ),
              secondaryAction: React.createElement(
                Action,
                {
                  swipeProgress: progress,
                  side: "right",
                  bgColor: "var(--hue-4)"
                },
                React.createElement(ActionContent, { icon: FlagIcon, label: "Action 4" })
              )
            })
          )
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(React.createElement(SwipeDemo));
    })();
  </script>
</body>
</html>
