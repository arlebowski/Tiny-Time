<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#E0E7FF">
  <title>Tiny Tracker</title>
  <!-- Blocking script to prevent theme flash -->
  <script>
    (function() {
      try {
        // Check localStorage for cached appearance preference
        const cached = localStorage.getItem('tt_appearance_cache');
        if (cached) {
          const appearance = JSON.parse(cached);
          const root = document.documentElement;
          
          // Apply dark class immediately
          if (appearance.darkMode) {
            root.classList.add('dark');
          } else {
            root.classList.remove('dark');
          }
          
          // Set basic CSS variables to prevent flash
          const darkMode = appearance.darkMode || false;
          const background = appearance.background || 'health-gray';
          
          // Basic theme colors (will be refined by applyAppearance() later)
          if (darkMode) {
            root.style.setProperty('--tt-app-bg', '#0F0F10');
            root.style.setProperty('--tt-card-bg', '#1E1E20');
            root.style.setProperty('--tt-card-border', 'transparent');
            root.style.setProperty('--tt-input-bg', '#2C2C2E');
            // Subtle surface (used for log list items, pills, etc.)
            root.style.setProperty('--tt-subtle-surface', 'rgba(255,255,255,0.05)');
            root.style.setProperty('--tt-surface-subtle', 'rgba(255,255,255,0.05)');
            root.style.setProperty('--tt-surface-selected', 'rgba(255,255,255,0.12)');
            root.style.setProperty('--tt-surface-hover', 'rgba(255,255,255,0.08)');
            root.style.setProperty('--tt-progress-track', 'rgba(255,255,255,0.05)');
            root.style.setProperty('--tt-timeline-item-bg', '#1E1E20');
            root.style.setProperty('--tt-timeline-track-bg', 'rgba(255,255,255,0.05)');
            root.style.setProperty('--tt-halfsheet-bg', '#1E1E20');
            root.style.setProperty('--tt-wheelpicker-bar', 'rgba(255,255,255,0.05)');
            root.style.setProperty('--tt-icon-bg', '#2C2C2E');
            root.style.setProperty('--tt-input-border', 'rgba(255,255,255,0.10)');
            root.style.setProperty('--tt-divider', 'rgba(255,255,255,0.10)');
            root.style.setProperty('--tt-tracker-card-bg', '#1E1E20');
            root.style.setProperty('--tt-seg-track', 'rgba(255,255,255,0.05)');
            root.style.setProperty('--tt-seg-pill', 'rgba(255,255,255,0.12)');
            // Swipe row background (opaque)
            root.style.setProperty('--tt-swipe-row-bg', '#272727');
            // Selected surface (e.g., calendar selected pill)
            root.style.setProperty('--tt-selected-surface', 'rgba(255,255,255,0.12)');
            root.style.setProperty('--tt-text-primary', 'rgba(255,255,255,0.87)');
            root.style.setProperty('--tt-text-secondary', 'rgba(255,255,255,0.60)');
            root.style.setProperty('--tt-text-tertiary', 'rgba(255,255,255,0.38)');
            root.style.setProperty('--tt-tray-bg', '#222224');
            root.style.setProperty('--tt-tray-shadow', '0 -10px 28px rgba(0,0,0,0.35)');
            root.style.setProperty('--tt-tray-divider', 'rgba(255,255,255,0.08)');
          } else {
            const bgTheme = background === 'eggshell' ? '#f6f1e7' : '#f3f4f6';
            const lightTokens = background === 'eggshell'
              ? {
                  inputBg: '#3C3E43',
                  subtleSurface: 'rgba(0,0,0,0.03)',
                  surfaceSubtle: 'rgba(0,0,0,0.03)',
                  surfaceSelected: 'rgba(0,0,0,0.08)',
                  surfaceHover: 'rgba(0,0,0,0.03)',
                  progressTrack: 'rgba(0,0,0,0.03)',
                  timelineItemBg: '#ffffff',
                  timelineTrackBg: 'rgba(0,0,0,0.03)',
                  halfsheetBg: '#ffffff',
                  wheelpickerBar: 'rgba(0,0,0,0.03)',
                  iconBg: '#f5f5f5',
                  inputBorder: 'rgba(0,0,0,0.08)',
                  divider: 'rgba(0,0,0,0.08)',
                  trackerCardBg: '#ffffff',
                  segTrack: 'rgba(0,0,0,0.03)',
                  segPill: '#ffffff',
                  swipeRowBg: '#F7F7F7',
                  selectedSurface: 'rgba(0,0,0,0.08)',
                  plusBg: '#000000',
                  plusFg: '#ffffff',
                  textPrimary: 'rgba(0,0,0,0.87)',
                  textSecondary: 'rgba(0,0,0,0.60)',
                  textTertiary: 'rgba(0,0,0,0.38)',
                  trayBg: '#ffffff',
                  trayShadow: '0 -10px 28px rgba(0,0,0,0.18)',
                  trayDivider: 'rgba(0,0,0,0.06)'
                }
              : {
                  inputBg: '#3C3E43',
                  subtleSurface: 'rgba(0,0,0,0.03)',
                  surfaceSubtle: 'rgba(0,0,0,0.03)',
                  surfaceSelected: 'rgba(0,0,0,0.08)',
                  surfaceHover: 'rgba(0,0,0,0.03)',
                  progressTrack: 'rgba(0,0,0,0.03)',
                  timelineItemBg: '#ffffff',
                  timelineTrackBg: 'rgba(0,0,0,0.03)',
                  halfsheetBg: '#ffffff',
                  wheelpickerBar: 'rgba(0,0,0,0.03)',
                  iconBg: '#f5f5f5',
                  inputBorder: 'rgba(0,0,0,0.08)',
                  divider: 'rgba(0,0,0,0.08)',
                  trackerCardBg: '#ffffff',
                  segTrack: 'rgba(0,0,0,0.03)',
                  segPill: '#ffffff',
                  swipeRowBg: '#F7F7F7',
                  selectedSurface: 'rgba(0,0,0,0.08)',
                  plusBg: '#000000',
                  plusFg: '#ffffff',
                  textPrimary: 'rgba(0,0,0,0.87)',
                  textSecondary: 'rgba(0,0,0,0.60)',
                  textTertiary: 'rgba(0,0,0,0.38)',
                  trayBg: '#ffffff',
                  trayShadow: '0 -10px 28px rgba(0,0,0,0.18)',
                  trayDivider: 'rgba(0,0,0,0.06)'
                };
            root.style.setProperty('--tt-app-bg', bgTheme);
            root.style.setProperty('--tt-card-bg', '#ffffff');
            root.style.setProperty('--tt-card-border', 'transparent');
            root.style.setProperty('--tt-input-bg', lightTokens.inputBg);
            // Subtle surface (used for log list items, pills, etc.)
            root.style.setProperty('--tt-subtle-surface', lightTokens.subtleSurface);
            root.style.setProperty('--tt-surface-subtle', lightTokens.surfaceSubtle);
            root.style.setProperty('--tt-surface-selected', lightTokens.surfaceSelected);
            root.style.setProperty('--tt-surface-hover', lightTokens.surfaceHover);
            root.style.setProperty('--tt-progress-track', lightTokens.progressTrack);
            root.style.setProperty('--tt-timeline-item-bg', lightTokens.timelineItemBg);
            root.style.setProperty('--tt-timeline-track-bg', lightTokens.timelineTrackBg);
            root.style.setProperty('--tt-halfsheet-bg', lightTokens.halfsheetBg);
            root.style.setProperty('--tt-wheelpicker-bar', lightTokens.wheelpickerBar);
            root.style.setProperty('--tt-icon-bg', lightTokens.iconBg);
            root.style.setProperty('--tt-input-border', lightTokens.inputBorder);
            root.style.setProperty('--tt-divider', lightTokens.divider);
            root.style.setProperty('--tt-tracker-card-bg', lightTokens.trackerCardBg);
            root.style.setProperty('--tt-seg-track', lightTokens.segTrack);
            root.style.setProperty('--tt-seg-pill', lightTokens.segPill);
            // Swipe row background (opaque)
            root.style.setProperty('--tt-swipe-row-bg', lightTokens.swipeRowBg);
            // Selected surface (e.g., calendar selected pill)
            root.style.setProperty('--tt-selected-surface', lightTokens.selectedSurface);
            root.style.setProperty('--tt-text-primary', lightTokens.textPrimary);
            root.style.setProperty('--tt-text-secondary', lightTokens.textSecondary);
            root.style.setProperty('--tt-text-tertiary', lightTokens.textTertiary);
            root.style.setProperty('--tt-tray-bg', lightTokens.trayBg);
            root.style.setProperty('--tt-tray-shadow', lightTokens.trayShadow);
            root.style.setProperty('--tt-tray-divider', lightTokens.trayDivider);
          }
          
          // Set accent colors if available
          if (appearance.feedAccent) {
            root.style.setProperty('--tt-feed', appearance.feedAccent);
          }
          if (appearance.sleepAccent) {
            root.style.setProperty('--tt-sleep', appearance.sleepAccent);
          }
        }
      } catch (e) {
        // Silently fail - full init will happen in script.js
      }
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Favicon / PWA -->
  <link rel="icon" type="image/png" href="assets/app-icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="assets/app-icons/icon-192.png">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Tiny Tracker">
  
  <!-- Firebase SDK v9 (modular) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- date-fns + Framer Motion (HorizontalCalendar) -->
  <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/dist/date-fns.min.js"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabaseUpload.js"></script>
  
  <!-- Material Symbols -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
  <link rel="stylesheet" href="components/shared/NextUpCard.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap');
    .handwriting {
      font-family: 'Caveat', cursive;
    }
    * {
      -webkit-tap-highlight-color: transparent;
    }
    body {
      overscroll-behavior: none;
    }
    
    /* ============================================
       FIX: Date/Time input overflow on mobile devices
       ============================================
       Issue: Native date/time inputs were overhanging cards on actual mobile
       devices even though they appeared fine in desktop browser dev tools.

       Root cause:
       - Mobile browsers (especially iOS Safari) handle date/time inputs differently
       - Grid items have default min-width: auto which prevents shrinking
       - Native pickers inside tight layouts need explicit width constraints

       Solution: Force proper box-sizing and width constraints on native pickers
       and allow grid children to shrink so inputs respect card width.
    */
    input[type="date"],
    input[type="time"] {
      box-sizing: border-box !important;
      max-width: 100% !important;
      min-width: 11ch !important; /* ensure full yyyy-mm-dd is always visible */
      width: 100% !important;
    }
    /* Allow grid children to shrink below content size (critical for native pickers) */
    .grid > * {
      min-width: 0;
    }
    /* Prevent horizontal overflow in white card containers */
    .bg-white.rounded-3xl,
    .bg-white.rounded-2xl {
      overflow-x: hidden;
    }

    /* Allow dual-thumb day sleep slider to capture events on both handles */
    .day-sleep-slider input[type="range"] {
      pointer-events: none;
      background: transparent;
      -webkit-appearance: none;
      appearance: none;
    }
    .day-sleep-slider input[type="range"]::-webkit-slider-thumb {
      pointer-events: auto;
      -webkit-appearance: none;
      width: 32px;
      height: 48px;
      background: transparent;
      border: none;
    }
    .day-sleep-slider input[type="range"]::-moz-range-thumb {
      pointer-events: auto;
      width: 32px;
      height: 48px;
      background: transparent;
      border: none;
    }

    .trackerEditBlock {
      width: 100%;
      max-width: 560px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .trackerEditGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      width: 100%;
      box-sizing: border-box;
      align-items: stretch;
    }

    .trackerEditGrid > * {
      width: 100%;
      box-sizing: border-box;
    }

    .editFieldLabel {
      font-size: 12px;
      line-height: 12px;
      margin-bottom: 6px;
      color: rgba(0,0,0,0.55);
      font-weight: 600;
    }

    .editField {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .feedingAmountField {
      position: relative;
      width: 100%;
      box-sizing: border-box;
    }

    .feedingAmountInput {
      width: 100%;
      padding-right: 40px;
      box-sizing: border-box;
    }

    .feedingAmountUnit {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      user-select: none;
      color: rgba(0,0,0,0.55);
      font-size: 13px;
    }

    .trackerEditBtn {
      width: 100%;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-sizing: border-box;
    }

    /* Category accent colors for Analytics highlight cards */
    :root {
      --color-daily: #3B82F6;
      --color-sleep: #4F46E5;
      --color-eating: #EC4899;
    }

    /* 2-line clamp for insight text */
    .insight-text-clamp {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-white">
  <div id="root"></div>
  <script src="components/ui_primitives.js"></script>
  <script src="components/shared/TTInputRow.js"></script>
  <script src="components/shared/TTPhotoRow.js"></script>
  <script src="components/shared/TTSwipeRow.js"></script>
  <script src="components/shared/TTCardHeader.js"></script>
  <script src="components/shared/SegmentedToggle.js"></script>
  <script src="components/shared/Wheelpickers.js"></script>
  <script src="components/shared/HorizontalCalendar.js"></script>
  <script src="components/shared/NextUpCard.js"></script>
  <script src="components/shared/scheduleUtils.js"></script>
  <script src="components/shared/scheduleStore.js"></script>
  <script src="components/shared/useActiveSleep.js"></script>
  <script src="components/shared/TimelineItem.js"></script>
  <script src="components/shared/Timeline.js"></script>
  <script src="components/TrackerCard.js"></script>
  <script src="components/shared/TTHalfSheet.js"></script>
  <script src="components/shared/icons.js"></script>
  <script src="components/shared/FloatingTrackerMenu.js"></script>
  <script src="components/shared/TTCard.js"></script>
  <script src="components/halfsheets/TTFeedDetailSheet.js"></script>
  <script src="components/halfsheets/TTSleepDetailSheet.js"></script>
  <script src="components/halfsheets/TTInputHalfSheet.js"></script>
  <script src="components/tabs/TrackerTab.js"></script>
  <script src="components/tabs/AnalyticsTab.js"></script>
  <script src="components/tabs/FeedingAnalyticsTab.js"></script>
  <script src="components/tabs/SleepAnalyticsTab.js"></script>
  <script src="components/tabs/ActivityAnalyticsTab.js"></script>
  <script src="components/tabs/AIChatTab.js"></script>
  <script src="components/tabs/ScheduleTab.js"></script>
  <script src="components/tabs/TrackerDetailTab.js"></script>
  <script src="components/tabs/FamilyTab.js"></script>
  <script src="components/tabs/SettingsTab.js"></script>
  <script src="script.js?v=20251215a"></script>
</body>
</html>
