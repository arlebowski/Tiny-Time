<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#E0E7FF">
  <title>Tiny Tracker</title>
  <script src="theme/tokens.js"></script>
  <!-- Blocking script to prevent theme flash -->
  <script>
    (function() {
      try {
        // Check localStorage for cached appearance preference
        const cached = localStorage.getItem('tt_appearance_cache');
        if (cached) {
          const appearance = JSON.parse(cached);
          const root = document.documentElement;
          
          // Apply dark class immediately
          if (appearance.darkMode) {
            root.classList.add('dark');
          } else {
            root.classList.remove('dark');
          }
          
          // Set basic CSS variables to prevent flash
          const darkMode = appearance.darkMode || false;
          const background = appearance.background || 'health-gray';
          
          const themeTokens = (window.TT && window.TT.themeTokens) ? window.TT.themeTokens : {};
          const backgroundThemes = themeTokens.BACKGROUND_THEMES || {};
          const lightModeTokens = themeTokens.LIGHT_MODE_TOKENS || {};
          const darkModeTokens = themeTokens.DARK_MODE_TOKENS || {};
          const analyticsColors = themeTokens.ANALYTICS_CATEGORY_COLORS || {};

          const modeThemes = darkMode ? backgroundThemes.dark : backgroundThemes.light;
          const themeEntry = (modeThemes && (modeThemes[background] || modeThemes["health-gray"])) || {};

          // Basic theme colors (will be refined by applyAppearance() later)
          if (darkMode) {
            root.style.setProperty('--tt-app-bg', themeEntry.appBg);
            root.style.setProperty('--tt-card-bg', themeEntry.cardBg);
            root.style.setProperty('--tt-card-border', themeEntry.cardBorder);
            root.style.setProperty('--tt-input-bg', darkModeTokens.inputBg);
            // Subtle surface (used for log list items, pills, etc.)
            root.style.setProperty('--tt-subtle-surface', darkModeTokens.subtleSurface);
            root.style.setProperty('--tt-surface-subtle', darkModeTokens.surfaceSubtle);
            root.style.setProperty('--tt-surface-selected', darkModeTokens.surfaceSelected);
            root.style.setProperty('--tt-surface-hover', darkModeTokens.surfaceHover);
            root.style.setProperty('--tt-progress-track', darkModeTokens.progressTrack);
            root.style.setProperty('--tt-timeline-item-bg', themeEntry.cardBg);
            root.style.setProperty('--tt-timeline-track-bg', darkModeTokens.timelineTrackBg);
            root.style.setProperty('--tt-halfsheet-bg', themeEntry.cardBg);
            root.style.setProperty('--tt-wheelpicker-bar', darkModeTokens.wheelpickerBar);
            root.style.setProperty('--tt-icon-bg', darkModeTokens.iconBg);
            root.style.setProperty('--tt-input-border', darkModeTokens.inputBorder);
            root.style.setProperty('--tt-divider', darkModeTokens.divider);
            root.style.setProperty('--tt-tracker-card-bg', themeEntry.cardBg);
            root.style.setProperty('--tt-seg-track', darkModeTokens.segTrack);
            root.style.setProperty('--tt-seg-pill', darkModeTokens.segPill);
            // Swipe row background (opaque)
            root.style.setProperty('--tt-swipe-row-bg', darkModeTokens.swipeRowBg);
            // Selected surface (e.g., calendar selected pill)
            root.style.setProperty('--tt-selected-surface', darkModeTokens.selectedSurface);
            root.style.setProperty('--tt-text-primary', darkModeTokens.textPrimary);
            root.style.setProperty('--tt-text-secondary', darkModeTokens.textSecondary);
            root.style.setProperty('--tt-text-tertiary', darkModeTokens.textTertiary);
            root.style.setProperty('--tt-text-on-accent', darkModeTokens.textOnAccent);
            root.style.setProperty('--tt-tapable-bg', darkModeTokens.tapableBg);
            root.style.setProperty('--tt-overlay-scrim', darkModeTokens.overlayScrim);
            root.style.setProperty('--tt-overlay-scrim-strong', darkModeTokens.overlayScrimStrong);
            root.style.setProperty('--tt-shadow-soft', darkModeTokens.shadowSoft);
            root.style.setProperty('--tt-shadow-floating', darkModeTokens.shadowFloating);
            root.style.setProperty('--tt-text-shadow', darkModeTokens.textShadow);
            root.style.setProperty('--tt-outline-strong', darkModeTokens.outlineStrong);
            root.style.setProperty('--tt-nav-disabled', darkModeTokens.navDisabled);
            root.style.setProperty('--tt-nav-divider', darkModeTokens.navDivider);
            root.style.setProperty('--tt-nav-pill-border', darkModeTokens.navPillBorder);
            root.style.setProperty('--tt-segmented-track-bg', darkModeTokens.segmentedTrackBg);
            root.style.setProperty('--tt-segmented-shadow', darkModeTokens.segmentedShadow);
            root.style.setProperty('--tt-segmented-on-bg', darkModeTokens.segmentedOnBg);
            root.style.setProperty('--tt-segmented-on-text', darkModeTokens.segmentedOnText);
            root.style.setProperty('--tt-segmented-off-text', darkModeTokens.segmentedOffText);
            root.style.setProperty('--tt-primary-action-bg', darkModeTokens.primaryActionBg);
            root.style.setProperty('--tt-primary-action-bg-active', darkModeTokens.primaryActionBgActive);
            root.style.setProperty('--tt-primary-action-shadow', darkModeTokens.primaryActionShadow);
            root.style.setProperty('--tt-primary-action-shadow-active', darkModeTokens.primaryActionShadowActive);
            root.style.setProperty('--tt-primary-action-text', darkModeTokens.primaryActionText);
            root.style.setProperty('--tt-primary-brand', darkModeTokens.primaryBrand);
            root.style.setProperty('--tt-primary-brand-soft', darkModeTokens.primaryBrandSoft);
            root.style.setProperty('--tt-primary-brand-strong', darkModeTokens.primaryBrandStrong);
            root.style.setProperty('--tt-recovery-bg', darkModeTokens.recoveryBg);
            root.style.setProperty('--tt-error', darkModeTokens.error);
            root.style.setProperty('--tt-error-soft', darkModeTokens.errorSoft);
            root.style.setProperty('--tt-positive', darkModeTokens.positive);
            root.style.setProperty('--tt-positive-soft', darkModeTokens.positiveSoft);
            root.style.setProperty('--tt-positive-alt', darkModeTokens.positiveAlt);
            root.style.setProperty('--tt-positive-alt-soft', darkModeTokens.positiveAltSoft);
            root.style.setProperty('--tt-negative', darkModeTokens.negative);
            root.style.setProperty('--tt-negative-soft', darkModeTokens.negativeSoft);
            root.style.setProperty('--tt-negative-warm', darkModeTokens.negativeWarm);
            root.style.setProperty('--tt-negative-warm-soft', darkModeTokens.negativeWarmSoft);
            root.style.setProperty('--tt-pulse-highlight', darkModeTokens.pulseHighlight);
            root.style.setProperty('--tt-highlight-indigo-soft', darkModeTokens.highlightIndigoSoft);
            root.style.setProperty('--tt-tray-bg', darkModeTokens.trayBg);
            root.style.setProperty('--tt-tray-shadow', darkModeTokens.trayShadow);
            root.style.setProperty('--tt-tray-divider', darkModeTokens.trayDivider);
          } else {
            const lightTokens = lightModeTokens[background] || lightModeTokens["health-gray"] || {};
            root.style.setProperty('--tt-app-bg', themeEntry.appBg);
            root.style.setProperty('--tt-card-bg', themeEntry.cardBg);
            root.style.setProperty('--tt-card-border', themeEntry.cardBorder);
            root.style.setProperty('--tt-input-bg', lightTokens.inputBg);
            // Subtle surface (used for log list items, pills, etc.)
            root.style.setProperty('--tt-subtle-surface', lightTokens.subtleSurface);
            root.style.setProperty('--tt-surface-subtle', lightTokens.surfaceSubtle);
            root.style.setProperty('--tt-surface-selected', lightTokens.surfaceSelected);
            root.style.setProperty('--tt-surface-hover', lightTokens.surfaceHover);
            root.style.setProperty('--tt-progress-track', lightTokens.progressTrack);
            root.style.setProperty('--tt-timeline-item-bg', lightTokens.timelineItemBg);
            root.style.setProperty('--tt-timeline-track-bg', lightTokens.timelineTrackBg);
            root.style.setProperty('--tt-halfsheet-bg', lightTokens.halfsheetBg);
            root.style.setProperty('--tt-wheelpicker-bar', lightTokens.wheelpickerBar);
            root.style.setProperty('--tt-icon-bg', lightTokens.iconBg);
            root.style.setProperty('--tt-input-border', lightTokens.inputBorder);
            root.style.setProperty('--tt-divider', lightTokens.divider);
            root.style.setProperty('--tt-tracker-card-bg', lightTokens.trackerCardBg);
            root.style.setProperty('--tt-seg-track', lightTokens.segTrack);
            root.style.setProperty('--tt-seg-pill', lightTokens.segPill);
            // Swipe row background (opaque)
            root.style.setProperty('--tt-swipe-row-bg', lightTokens.swipeRowBg);
            // Selected surface (e.g., calendar selected pill)
            root.style.setProperty('--tt-selected-surface', lightTokens.selectedSurface);
            root.style.setProperty('--tt-text-primary', lightTokens.textPrimary);
            root.style.setProperty('--tt-text-secondary', lightTokens.textSecondary);
            root.style.setProperty('--tt-text-tertiary', lightTokens.textTertiary);
            root.style.setProperty('--tt-text-on-accent', lightTokens.textOnAccent);
            root.style.setProperty('--tt-tapable-bg', lightTokens.tapableBg);
            root.style.setProperty('--tt-overlay-scrim', lightTokens.overlayScrim);
            root.style.setProperty('--tt-overlay-scrim-strong', lightTokens.overlayScrimStrong);
            root.style.setProperty('--tt-shadow-soft', lightTokens.shadowSoft);
            root.style.setProperty('--tt-shadow-floating', lightTokens.shadowFloating);
            root.style.setProperty('--tt-text-shadow', lightTokens.textShadow);
            root.style.setProperty('--tt-outline-strong', lightTokens.outlineStrong);
            root.style.setProperty('--tt-nav-disabled', lightTokens.navDisabled);
            root.style.setProperty('--tt-nav-divider', lightTokens.navDivider);
            root.style.setProperty('--tt-nav-pill-border', lightTokens.navPillBorder);
            root.style.setProperty('--tt-segmented-track-bg', lightTokens.segmentedTrackBg);
            root.style.setProperty('--tt-segmented-shadow', lightTokens.segmentedShadow);
            root.style.setProperty('--tt-segmented-on-bg', lightTokens.segmentedOnBg);
            root.style.setProperty('--tt-segmented-on-text', lightTokens.segmentedOnText);
            root.style.setProperty('--tt-segmented-off-text', lightTokens.segmentedOffText);
            root.style.setProperty('--tt-primary-action-bg', lightTokens.primaryActionBg);
            root.style.setProperty('--tt-primary-action-bg-active', lightTokens.primaryActionBgActive);
            root.style.setProperty('--tt-primary-action-shadow', lightTokens.primaryActionShadow);
            root.style.setProperty('--tt-primary-action-shadow-active', lightTokens.primaryActionShadowActive);
            root.style.setProperty('--tt-primary-action-text', lightTokens.primaryActionText);
            root.style.setProperty('--tt-primary-brand', lightTokens.primaryBrand);
            root.style.setProperty('--tt-primary-brand-soft', lightTokens.primaryBrandSoft);
            root.style.setProperty('--tt-primary-brand-strong', lightTokens.primaryBrandStrong);
            root.style.setProperty('--tt-recovery-bg', lightTokens.recoveryBg);
            root.style.setProperty('--tt-error', lightTokens.error);
            root.style.setProperty('--tt-error-soft', lightTokens.errorSoft);
            root.style.setProperty('--tt-positive', lightTokens.positive);
            root.style.setProperty('--tt-positive-soft', lightTokens.positiveSoft);
            root.style.setProperty('--tt-positive-alt', lightTokens.positiveAlt);
            root.style.setProperty('--tt-positive-alt-soft', lightTokens.positiveAltSoft);
            root.style.setProperty('--tt-negative', lightTokens.negative);
            root.style.setProperty('--tt-negative-soft', lightTokens.negativeSoft);
            root.style.setProperty('--tt-negative-warm', lightTokens.negativeWarm);
            root.style.setProperty('--tt-negative-warm-soft', lightTokens.negativeWarmSoft);
            root.style.setProperty('--tt-pulse-highlight', lightTokens.pulseHighlight);
            root.style.setProperty('--tt-highlight-indigo-soft', lightTokens.highlightIndigoSoft);
            root.style.setProperty('--tt-tray-bg', lightTokens.trayBg);
            root.style.setProperty('--tt-tray-shadow', lightTokens.trayShadow);
            root.style.setProperty('--tt-tray-divider', lightTokens.trayDivider);
          }

          if (analyticsColors.daily) {
            root.style.setProperty('--color-daily', analyticsColors.daily);
          }
          if (analyticsColors.sleep) {
            root.style.setProperty('--color-sleep', analyticsColors.sleep);
          }
          if (analyticsColors.eating) {
            root.style.setProperty('--color-eating', analyticsColors.eating);
          }
          
          // Set accent colors if available
          if (appearance.feedAccent) {
            root.style.setProperty('--tt-feed', appearance.feedAccent);
          }
          if (appearance.nursingAccent) {
            root.style.setProperty('--tt-nursing', appearance.nursingAccent);
          }
          if (appearance.sleepAccent) {
            root.style.setProperty('--tt-sleep', appearance.sleepAccent);
          }
        }
      } catch (e) {
        // Silently fail - full init will happen in script.js
      }
    })();
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Favicon / PWA -->
  <link rel="icon" type="image/png" href="assets/app-icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="assets/app-icons/icon-192.png">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Tiny Tracker">
  
  <!-- Firebase SDK v9 (modular) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
  
  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- date-fns + Framer Motion (HorizontalCalendar) -->
  <script src="https://cdn.jsdelivr.net/npm/date-fns@2.30.0/dist/date-fns.min.js"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabaseUpload.js"></script>
  
  <!-- Material Symbols -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
  <link rel="stylesheet" href="components/shared/NextUpCard.css">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap');
    .handwriting {
      font-family: 'Caveat', cursive;
    }
    * {
      -webkit-tap-highlight-color: transparent;
    }
    body {
      overscroll-behavior: none;
    }

    /* Tokenized utility overrides (single source of truth) */
    .bg-white { background-color: var(--tt-card-bg) !important; }
    .bg-white\/70 { background-color: var(--tt-segmented-track-bg) !important; }
    .bg-white\/10 { background-color: var(--tt-bg-hover) !important; }
    .bg-white\/5 { background-color: var(--tt-bg-hover) !important; }
    .bg-gray-50 { background-color: var(--tt-bg-hover) !important; }
    .bg-gray-100 { background-color: var(--tt-subtle-surface) !important; }
    .bg-gray-200 { background-color: var(--tt-surface-selected) !important; }
    .bg-black { background-color: var(--tt-overlay-scrim-strong) !important; }
    .bg-black\/75 { background-color: var(--tt-overlay-scrim-strong) !important; }
    .bg-black\/60 { background-color: var(--tt-overlay-scrim-strong) !important; }
    .bg-black\/50 { background-color: var(--tt-overlay-scrim) !important; }
    .bg-black\/5 { background-color: var(--tt-bg-hover) !important; }

    .hover\:bg-indigo-50:hover { background-color: var(--tt-highlight-indigo-soft) !important; }
    .hover\:bg-indigo-700:hover { background-color: var(--tt-primary-brand-strong) !important; }
    .hover\:bg-gray-50:hover { background-color: var(--tt-bg-hover) !important; }
    .hover\:bg-black\/5:hover { background-color: var(--tt-bg-hover) !important; }
    .active\:bg-black\/10:active { background-color: var(--tt-bg-hover) !important; }
    .dark .dark\:hover\:bg-white\/10:hover { background-color: var(--tt-bg-hover) !important; }

    .text-white { color: var(--tt-text-on-accent) !important; }
    .text-gray-900, .text-gray-800 { color: var(--tt-text-primary) !important; }
    .text-gray-700, .text-gray-600 { color: var(--tt-text-secondary) !important; }
    .text-gray-500, .text-gray-400 { color: var(--tt-text-tertiary) !important; }

    .text-indigo-600 { color: var(--tt-primary-brand) !important; }
    .bg-indigo-600 { background-color: var(--tt-primary-brand) !important; }
    .bg-indigo-700 { background-color: var(--tt-primary-brand-strong) !important; }
    .bg-indigo-100 { background-color: var(--tt-primary-brand-soft) !important; }
    .border-indigo-600 { border-color: var(--tt-primary-brand) !important; }

    .bg-blue-600 { background-color: var(--tt-primary-action-bg) !important; }
    .bg-blue-700 { background-color: var(--tt-primary-action-bg-active) !important; }

    .text-red-600, .text-red-500 { color: var(--tt-error) !important; }
    .bg-red-50 { background-color: var(--tt-error-soft) !important; }
    .border-red-200 { border-color: var(--tt-error) !important; }

    .text-green-600, .text-green-500 { color: var(--tt-positive) !important; }

    .border-gray-100, .border-gray-200 { border-color: var(--tt-border-subtle) !important; }
    .border-gray-300 { border-color: var(--tt-border-strong) !important; }
    
    /* ============================================
       FIX: Date/Time input overflow on mobile devices
       ============================================
       Issue: Native date/time inputs were overhanging cards on actual mobile
       devices even though they appeared fine in desktop browser dev tools.

       Root cause:
       - Mobile browsers (especially iOS Safari) handle date/time inputs differently
       - Grid items have default min-width: auto which prevents shrinking
       - Native pickers inside tight layouts need explicit width constraints

       Solution: Force proper box-sizing and width constraints on native pickers
       and allow grid children to shrink so inputs respect card width.
    */
    input[type="date"],
    input[type="time"] {
      box-sizing: border-box !important;
      max-width: 100% !important;
      min-width: 11ch !important; /* ensure full yyyy-mm-dd is always visible */
      width: 100% !important;
    }
    /* Allow grid children to shrink below content size (critical for native pickers) */
    .grid > * {
      min-width: 0;
    }
    /* Prevent horizontal overflow in white card containers */
    .bg-white.rounded-3xl,
    .bg-white.rounded-2xl {
      overflow-x: hidden;
    }

    /* Allow dual-thumb day sleep slider to capture events on both handles */
    .day-sleep-slider input[type="range"] {
      pointer-events: none;
      background: transparent;
      -webkit-appearance: none;
      appearance: none;
    }
    .day-sleep-slider input[type="range"]::-webkit-slider-thumb {
      pointer-events: auto;
      -webkit-appearance: none;
      width: 32px;
      height: 48px;
      background: transparent;
      border: none;
    }
    .day-sleep-slider input[type="range"]::-moz-range-thumb {
      pointer-events: auto;
      width: 32px;
      height: 48px;
      background: transparent;
      border: none;
    }

    .trackerEditBlock {
      width: 100%;
      max-width: 560px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .trackerEditGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      width: 100%;
      box-sizing: border-box;
      align-items: stretch;
    }

    .trackerEditGrid > * {
      width: 100%;
      box-sizing: border-box;
    }

    .editFieldLabel {
      font-size: 12px;
      line-height: 12px;
      margin-bottom: 6px;
      color: var(--tt-text-secondary);
      font-weight: 600;
    }

    .editField {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .feedingAmountField {
      position: relative;
      width: 100%;
      box-sizing: border-box;
    }

    .feedingAmountInput {
      width: 100%;
      padding-right: 40px;
      box-sizing: border-box;
    }

    .feedingAmountUnit {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      user-select: none;
      color: var(--tt-text-secondary);
      font-size: 13px;
    }

    .trackerEditBtn {
      width: 100%;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-sizing: border-box;
    }

    /* 2-line clamp for insight text */
    .insight-text-clamp {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body class="bg-white">
  <div id="root"></div>
  <script src="components/ui_primitives.js"></script>
  <script src="components/shared/TTInputRow.js"></script>
  <script src="components/shared/TTPhotoRow.js"></script>
  <script src="components/shared/TTCardHeader.js"></script>
  <script src="components/shared/SegmentedToggle.js"></script>
  <script src="components/shared/Wheelpickers.js"></script>
  <script src="components/shared/HorizontalCalendar.js"></script>
  <script src="components/shared/HorizontalCalendarCompact.js"></script>
  <script src="components/shared/NextUpCard.js"></script>
  <script src="components/shared/dataCache.js"></script>
  <script src="components/shared/useActiveSleep.js"></script>
  <script src="components/shared/TimelineItem.js"></script>
  <script src="components/shared/Timeline.js"></script>
  <script src="components/TrackerCard.js"></script>
  <script src="components/shared/TTHalfSheet.js"></script>
  <script src="components/shared/icons.js"></script>
  <script src="components/shared/FloatingTrackerMenu.js"></script>
  <script src="components/shared/TTCard.js"></script>
  <script src="components/shared/analyticsHelpers.js"></script>
  <script src="components/shared/analyticsCharts.js"></script>
  <script src="components/shared/featureFlags.js"></script>
  <script src="components/shared/TTAmountStepper.js"></script>
  <script src="components/halfsheets/DiaperSheet.js"></script>
  <script src="components/halfsheets/FeedSheet.js"></script>
  <script src="components/halfsheets/SleepSheet.js"></script>
  <script src="components/tabs/TrackerTab.js"></script>
  <script src="components/tabs/AnalyticsTab.js"></script>
  <script src="components/tabs/FeedingAnalyticsTab.js"></script>
  <script src="components/tabs/SleepAnalyticsTab.js"></script>
  <script src="components/tabs/TrackerDetailTab.js"></script>
  <script src="components/tabs/FamilyTab.js"></script>
  <script src="components/tabs/UILabTab.js"></script>
  <script src="components/tabs/SettingsTab.js"></script>
  <script src="script.js?v=20251215a"></script>
</body>
</html>
